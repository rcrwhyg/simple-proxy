# Simple Proxy

ä¸€ä¸ªåŸºäº Pingora çš„é«˜æ€§èƒ½åå‘ä»£ç†æœåŠ¡å™¨ï¼Œä¸“ä¸ºç°ä»£ Rust åº”ç”¨è®¾è®¡ã€‚

## ğŸš€ é¡¹ç›®æ¦‚è¿°

Simple Proxy æ˜¯ä¸€ä¸ªä½¿ç”¨ Cloudflare çš„ [Pingora](https://github.com/cloudflare/pingora) æ¡†æ¶æ„å»ºçš„åå‘ä»£ç†æœåŠ¡å™¨ã€‚å®ƒæä¾›äº†é«˜æ€§èƒ½çš„ HTTP ä»£ç†åŠŸèƒ½ï¼Œå¹¶åŒ…å«ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ç”¨æˆ·ç®¡ç†æœåŠ¡å™¨ä½œä¸ºä»£ç†ç›®æ ‡ã€‚

### ä¸»è¦ç‰¹æ€§

- **é«˜æ€§èƒ½åå‘ä»£ç†**: åŸºäº Pingora æ¡†æ¶ï¼Œæä¾›ä¼ä¸šçº§æ€§èƒ½
- **ç”¨æˆ·ç®¡ç† API**: å®Œæ•´çš„ CRUD æ“ä½œç¤ºä¾‹æœåŠ¡å™¨
- **å®‰å…¨å¯†ç å¤„ç†**: ä½¿ç”¨ Argon2 è¿›è¡Œå¯†ç å“ˆå¸Œ
- **å¹¶å‘å®‰å…¨**: ä½¿ç”¨ DashMap å®ç°æ— é”å¹¶å‘æ•°æ®ç»“æ„
- **å…¨é¢æµ‹è¯•è¦†ç›–**: åŒ…å« 17 ä¸ªå•å…ƒæµ‹è¯•ï¼Œè¦†ç›–æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
- **ç»“æ„åŒ–æ—¥å¿—**: é›†æˆ tracing å’Œè¯·æ±‚/å“åº”æ—¥å¿—
- **å¥åº·æ£€æŸ¥**: å†…ç½®å¥åº·æ£€æŸ¥ç«¯ç‚¹

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Rust 1.75+ (ä½¿ç”¨ Rust 2024 Edition)
- Linux/macOS/WSL2
- 8MB+ å¯ç”¨å†…å­˜

## ğŸ› ï¸ å®‰è£…å’Œè®¾ç½®

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/rcrwhyg/simple-proxy.git
cd simple-proxy
```

### 2. æ„å»ºé¡¹ç›®

```bash
# æ„å»ºåå‘ä»£ç†æœåŠ¡å™¨
cargo build --release

# æ„å»ºç¤ºä¾‹ç”¨æˆ·ç®¡ç†æœåŠ¡å™¨
cargo build --release --example server
```

### 3. è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# è¿è¡Œç¤ºä¾‹æœåŠ¡å™¨æµ‹è¯•
cargo test --example server
```

## ğŸš¦ å¿«é€Ÿå¼€å§‹

### å¯åŠ¨ç¤ºä¾‹æœåŠ¡å™¨

```bash
# åœ¨ç«¯å£ 3000 å¯åŠ¨ç”¨æˆ·ç®¡ç†æœåŠ¡å™¨
cargo run --example server
```

æœåŠ¡å™¨å¯åŠ¨åï¼Œä½ å°†çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š

```
æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œç›‘å¬åœ°å€: 127.0.0.1:3000
API ç«¯ç‚¹:
  GET    /users       - è·å–ç”¨æˆ·åˆ—è¡¨
  POST   /users       - åˆ›å»ºæ–°ç”¨æˆ·
  GET    /users/{id}  - è·å–æŒ‡å®šç”¨æˆ·
  PUT    /users/{id}  - æ›´æ–°æŒ‡å®šç”¨æˆ·
  DELETE /users/{id}  - åˆ é™¤æŒ‡å®šç”¨æˆ·
  GET    /health      - å¥åº·æ£€æŸ¥
```

### å¯åŠ¨åå‘ä»£ç†

```bash
# å¯åŠ¨åå‘ä»£ç†æœåŠ¡å™¨ï¼ˆä»£ç†åˆ°ç¤ºä¾‹æœåŠ¡å™¨ï¼‰
cargo run
```

## ğŸ“š API æ–‡æ¡£

### ç”¨æˆ·ç®¡ç†ç«¯ç‚¹

#### è·å–æ‰€æœ‰ç”¨æˆ·
```http
GET /users
```

**å“åº”ç¤ºä¾‹:**
```json
[
  {
    "id": 1,
    "email": "user@example.com",
    "name": "ç”¨æˆ·å",
    "create_at": "2024-01-15T10:30:00Z",
    "update_at": "2024-01-15T10:30:00Z"
  }
]
```

#### åˆ›å»ºæ–°ç”¨æˆ·
```http
POST /users
Content-Type: application/json

{
  "email": "newuser@example.com",
  "password": "securepassword123",
  "name": "æ–°ç”¨æˆ·"
}
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "id": 2,
  "email": "newuser@example.com",
  "name": "æ–°ç”¨æˆ·",
  "create_at": "2024-01-15T10:35:00Z",
  "update_at": "2024-01-15T10:35:00Z"
}
```

#### è·å–æŒ‡å®šç”¨æˆ·
```http
GET /users/{id}
```

#### æ›´æ–°ç”¨æˆ·ä¿¡æ¯
```http
PUT /users/{id}
Content-Type: application/json

{
  "email": "updated@example.com",
  "name": "æ›´æ–°åçš„ç”¨æˆ·å"
}
```

#### åˆ é™¤ç”¨æˆ·
```http
DELETE /users/{id}
```

#### å¥åº·æ£€æŸ¥
```http
GET /health
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "status": "healthy",
  "timestamp": "2024-01-15T10:40:00Z"
}
```

## ğŸ”§ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
simple-proxy/
â”œâ”€â”€ src/                    # åå‘ä»£ç†æ ¸å¿ƒä»£ç 
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ server.rs          # ç¤ºä¾‹ç”¨æˆ·ç®¡ç†æœåŠ¡å™¨
â”œâ”€â”€ specs/
â”‚   â””â”€â”€ 001-example-server.md  # æœåŠ¡å™¨è§„èŒƒæ–‡æ¡£
â”œâ”€â”€ Cargo.toml             # é¡¹ç›®ä¾èµ–é…ç½®
â””â”€â”€ README.md              # é¡¹ç›®æ–‡æ¡£
```

### æ ¸å¿ƒä¾èµ–

- **axum 0.8**: ç°ä»£å¼‚æ­¥ Web æ¡†æ¶
- **tokio 1.46**: å¼‚æ­¥è¿è¡Œæ—¶
- **dashmap 6.1**: å¹¶å‘å“ˆå¸Œæ˜ å°„
- **argon2 0.5**: å¯†ç å“ˆå¸Œç®—æ³•
- **serde 1.0**: åºåˆ—åŒ–/ååºåˆ—åŒ–
- **chrono 0.4**: æ—¥æœŸæ—¶é—´å¤„ç†
- **tracing**: ç»“æ„åŒ–æ—¥å¿—

### å¼€å‘å·¥ä½œæµ

1. **ç¼–ç **:
   ```bash
   # æ£€æŸ¥ä»£ç è´¨é‡
   cargo clippy
   ```

2. **æµ‹è¯•**:
   ```bash
   # è¿è¡Œæ‰€æœ‰æµ‹è¯•
   cargo test

   # è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
   cargo test --example server tests::test_create_user
   ```

3. **æ„å»º**:
   ```bash
   # å¼€å‘æ„å»º
   cargo build

   # å‘å¸ƒæ„å»º
   cargo build --release
   ```

### æ·»åŠ æ–°åŠŸèƒ½

1. **åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**:
   ```bash
   git checkout -b feature/new-feature
   ```

2. **ç¼–å†™æµ‹è¯•**:
   ```rust
   #[test]
   fn test_new_feature() {
       // æµ‹è¯•ä»£ç 
   }
   ```

3. **å®ç°åŠŸèƒ½**:
   ```rust
   // åŠŸèƒ½å®ç°
   ```

4. **éªŒè¯**:
   ```bash
   cargo test && cargo clippy
   ```

## ğŸ§ª æµ‹è¯•

é¡¹ç›®åŒ…å«å…¨é¢çš„æµ‹è¯•å¥—ä»¶ï¼š

### å•å…ƒæµ‹è¯•è¦†ç›–

- âœ… AppState åˆå§‹åŒ–
- âœ… ç”¨æˆ·åˆ›å»ºå’Œ ID ç”Ÿæˆ
- âœ… å¯†ç å“ˆå¸Œå’ŒéªŒè¯
- âœ… ç”¨æˆ·æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤
- âœ… ç”¨æˆ·åˆ—è¡¨è·å–
- âœ… å¥åº·æ£€æŸ¥
- âœ… å¹¶å‘å®‰å…¨æ€§
- âœ… åºåˆ—åŒ–è¡Œä¸ºï¼ˆå¯†ç æ’é™¤ï¼‰

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
cargo test --example server

# è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test test_create_user

# æ˜¾ç¤ºæµ‹è¯•è¾“å‡º
cargo test -- --nocapture
```

### æµ‹è¯•è¦†ç›–ç‡

```bash
# å®‰è£… cargo-tarpaulin
cargo install cargo-tarpaulin

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
cargo tarpaulin --example server
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„

```
å®¢æˆ·ç«¯è¯·æ±‚ â†’ åå‘ä»£ç† (Pingora) â†’ ç¤ºä¾‹æœåŠ¡å™¨ (Axum)
                 â†“
            è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ã€æ—¥å¿—
```

### æ•°æ®æµ

1. **è¯·æ±‚å¤„ç†**: å®¢æˆ·ç«¯å‘é€ HTTP è¯·æ±‚åˆ°åå‘ä»£ç†
2. **ä»£ç†è½¬å‘**: Pingora å°†è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨
3. **ä¸šåŠ¡é€»è¾‘**: Axum æœåŠ¡å™¨å¤„ç†ä¸šåŠ¡é€»è¾‘
4. **æ•°æ®å­˜å‚¨**: DashMap æä¾›å†…å­˜æ•°æ®å­˜å‚¨
5. **å“åº”è¿”å›**: å“åº”é€šè¿‡ä»£ç†è¿”å›ç»™å®¢æˆ·ç«¯

### å®‰å…¨ç‰¹æ€§

- **å¯†ç å®‰å…¨**: ä½¿ç”¨ Argon2 è¿›è¡Œå¯†ç å“ˆå¸Œ
- **æ•°æ®ä¿æŠ¤**: åºåˆ—åŒ–æ—¶è‡ªåŠ¨æ’é™¤æ•æ„Ÿå­—æ®µ
- **å¹¶å‘å®‰å…¨**: ä½¿ç”¨æ— é”æ•°æ®ç»“æ„é¿å…ç«æ€æ¡ä»¶
- **è¾“å…¥éªŒè¯**: ä¸¥æ ¼çš„è¯·æ±‚æ•°æ®éªŒè¯

## ğŸ“Š æ€§èƒ½ç‰¹æ€§

- **é›¶æ‹·è´**: Pingora æä¾›é«˜æ•ˆçš„å†…å­˜ä½¿ç”¨
- **å¼‚æ­¥å¤„ç†**: å…¨å¼‚æ­¥æ¶æ„æ”¯æŒé«˜å¹¶å‘
- **æ— é”è®¾è®¡**: DashMap é¿å…é”ç«äº‰
- **å†…å­˜é«˜æ•ˆ**: æœ€å°åŒ–å†…å­˜åˆ†é…å’Œå¤åˆ¶

## ğŸ” ç›‘æ§å’Œæ—¥å¿—

### ç»“æ„åŒ–æ—¥å¿—

é¡¹ç›®ä½¿ç”¨ `tracing` æä¾›ç»“æ„åŒ–æ—¥å¿—ï¼š

```rust
// è¯·æ±‚æ—¥å¿—
info!("on_request: {:?}", request);

// å“åº”æ—¥å¿—
info!("on_response: {:?}", response);
```

### å¥åº·æ£€æŸ¥

å†…ç½®å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼š

```bash
curl http://localhost:3000/health
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. **Fork é¡¹ç›®**
2. **åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**: `git checkout -b feature/amazing-feature`
3. **æäº¤æ›´æ”¹**: `git commit -m 'Add amazing feature'`
4. **æ¨é€åˆ†æ”¯**: `git push origin feature/amazing-feature`
5. **åˆ›å»º Pull Request**

### ä»£ç è§„èŒƒ

- éµå¾ª Rust 2024 Edition æ ‡å‡†
- ä½¿ç”¨ `cargo fmt` æ ¼å¼åŒ–ä»£ç 
- ä½¿ç”¨ `cargo clippy` è¿›è¡Œä»£ç æ£€æŸ¥
- ä¸ºæ–°åŠŸèƒ½ç¼–å†™æµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE.md](LICENSE.md) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [Pingora](https://github.com/cloudflare/pingora) - é«˜æ€§èƒ½ä»£ç†æ¡†æ¶
- [Axum](https://github.com/tokio-rs/axum) - ç°ä»£ Rust Web æ¡†æ¶
- [Tokio](https://tokio.rs/) - å¼‚æ­¥è¿è¡Œæ—¶

## ğŸ“ è”ç³»æ–¹å¼

- **ä½œè€…**: rcrwhyg
- **é‚®ç®±**: rcrwhyg@sina.com
- **GitHub**: [https://github.com/rcrwhyg/simple-proxy](https://github.com/rcrwhyg/simple-proxy)

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®ï¼Œç”¨äºæ¼”ç¤ºåå‘ä»£ç†å’Œ Web æœåŠ¡å™¨é›†æˆã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰ï¼Œè¯·ç¡®ä¿è¿›è¡Œé€‚å½“çš„å®‰å…¨å®¡æŸ¥å’Œæ€§èƒ½æµ‹è¯•ã€‚
